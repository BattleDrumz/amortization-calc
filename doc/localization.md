# Localization Documentation

This document describes the internationalization (i18n) and localization (l10n) implementation for the Amortization Calculator simulation.

## Overview

The Amortization Calculator follows PhET's localization standards, making it translatable into multiple languages through a string-based system. All user-facing text uses `LocalizedStringProperty` instances that automatically update when the language changes.

## Architecture

### String System Components

1. **Source File**: `amortization-calc-strings_en.json`
   - Human-editable JSON containing English strings (source language)
   - Includes string values and optional metadata
   - Version-controlled and serves as the reference for translators

2. **Generated TypeScript Interface**: `js/AmortizationCalcStrings.ts`
   - Auto-generated by `grunt update` command
   - Provides type-safe access to all string properties
   - Never edit manually — regenerate after changing JSON

3. **Runtime Module**: Loaded by `getStringModule()`
   - Automatically selects correct language file based on `?locale=` query parameter
   - Returns typed object with `LocalizedStringProperty` instances
   - Supports dynamic language switching

### String File Structure

**Basic string:**
```json
{
  "loanAmount": {
    "value": "Loan Amount ($):"
  }
}
```

**String with pattern variables:**
```json
{
  "monthlyPayment": {
    "value": "Monthly Payment: {{amount}}"
  }
}
```

**String with metadata (optional):**
```json
{
  "amortizeButton": {
    "value": "Amortize!",
    "comment": "Button label to calculate amortization schedule"
  }
}
```

## Implementation Guide

### Step 1: Define Strings in JSON

Add all user-facing text to `amortization-calc-strings_en.json`:

```json
{
  "amortization-calc.title": {
    "value": "Amortization Calculator"
  },
  "loanAmount": {
    "value": "Loan Amount ($):"
  },
  "monthlyPayment": {
    "value": "Monthly Payment: {{amount}}"
  }
}
```

**Key conventions:**
- Use camelCase for string keys
- Use `{{variableName}}` for dynamic values
- Use nested structure for namespacing (e.g., `"amortization-calc.title"`)
- Add comments for translators when context is needed

### Step 2: Regenerate TypeScript Interface

After modifying the JSON file, run:
```bash
grunt update
```

This regenerates `js/AmortizationCalcStrings.ts` with type-safe property accessors:
```typescript
type StringsType = {
  'amortization-calc': {
    'titleStringProperty': LocalizedStringProperty;
  };
  'loanAmountStringProperty': LocalizedStringProperty;
  'monthlyPaymentStringProperty': LocalizedStringProperty;
  // ... etc
};
```

### Step 3: Use Strings in Code

#### Simple String Usage

```typescript
import AmortizationCalcStrings from '../../AmortizationCalcStrings.js';

// Direct property usage
const titleText = new Text( AmortizationCalcStrings.loanAmountStringProperty, {
  font: new PhetFont( 14 )
} );
```

#### String Pattern with Variables

For strings containing `{{variable}}` placeholders, use `StringUtils.fillIn()` with `DerivedProperty`:

```typescript
import StringUtils from '../../../../phetcommon/js/util/StringUtils.js';
import { DerivedProperty } from '../../../../axon/js/imports.js';

// Create derived property that fills in the pattern
const monthlyPaymentTextProperty = new DerivedProperty(
  [ AmortizationCalcStrings.monthlyPaymentStringProperty, monthlyPaymentProperty ],
  ( pattern: string, amount: number ) => {
    return StringUtils.fillIn( pattern, {
      amount: `$${amount.toFixed( 2 )}`
    } );
  }
);

// Use the derived property
const paymentText = new Text( monthlyPaymentTextProperty, {
  font: new PhetFont( 16 )
} );
```

#### Accessibility (PDOM) Labels

```typescript
const loanAmountControl = new NumberControl(
  AmortizationCalcStrings.loanAmountStringProperty,
  loanAmountProperty,
  loanAmountRange,
  {
    // Visual label
    labelNode: new Text( AmortizationCalcStrings.loanAmountStringProperty ),
    
    // Accessibility
    tagName: 'div',
    labelTagName: 'label',
    labelContent: AmortizationCalcStrings.loanAmountStringProperty,
    descriptionContent: 'Enter the total amount you wish to borrow.'
  }
);
```

## Current Strings Catalog

The simulation includes 27 localized strings:

### Application Strings
- `amortization-calc.title` — Simulation title
- `screen.name` — Screen name

### Input Controls
- `loanExplorer` — Control panel title
- `loanAmount` — Loan amount label
- `term` — Term selector label
- `years15` — 15-year option
- `years30` — 30-year option
- `interestRate` — Interest rate label
- `amortizeButton` — Calculate button text

### Results Display
- `monthlyPayment` — Pattern: "Monthly Payment: {{amount}}"

### Extra Payment Section
- `extraPaymentTitle` — Extra payment panel title
- `extraMonthlyPayment` — Extra payment input label
- `reAmortizeButton` — Recalculate button text

### Graph Labels
- `paymentBreakdown` — Chart panel title
- `standardMonths` — Pattern: "Standard: {{months}} months"
- `withExtraMonths` — Pattern: "With Extra: {{months}} months"
- `total` — Pattern: "Total: {{amount}}"
- `interest` — Pattern: "Interest: {{amount}}"
- `monthlyPaymentAxis` — Y-axis label
- `year` — Pattern: "Year {{number}}"
- `month` — Pattern: "Month {{number}}"
- `principal` — Pattern: "Principal: {{amount}}"
- `was` — Pattern: "was {{amount}}" (for comparison tooltips)

### Legend
- `legendPrincipal` — "Green: Principal"
- `legendInterest` — "Orange: Interest"
- `legendDashed` — "Dashed: Standard Payments"
- `legendSolid` — "Solid: Extra Payments"

### Validation
- `pleaseEnterPositiveValues` — Error message

## Translation Workflow

### For Developers

1. **Add new strings** to `amortization-calc-strings_en.json`
2. **Run `grunt update`** to regenerate TypeScript interface
3. **Update code** to use new `StringProperty` instances
4. **Test** with `?locale=en` to verify

### For Translators

PhET's standard translation workflow:

1. **Receive English source file** (`amortization-calc-strings_en.json`)
2. **Create localized copy** (e.g., `amortization-calc-strings_es.json`)
3. **Translate all `value` fields** while preserving:
   - JSON structure
   - Pattern placeholders: `{{variableName}}`
   - Key names (do not translate)
4. **Preserve formatting** for numbers, currency, etc.
5. **Submit** translated file to PhET team

**Example Spanish translation:**
```json
{
  "loanAmount": {
    "value": "Monto del Préstamo ($):"
  },
  "monthlyPayment": {
    "value": "Pago Mensual: {{amount}}"
  }
}
```

### Supported Languages

The simulation can be run in any language by:
1. Creating a `amortization-calc-strings_[locale].json` file
2. Adding `?locale=[locale]` to the URL

Common locale codes:
- `en` — English (default)
- `es` — Spanish
- `fr` — French
- `de` — German
- `zh_CN` — Chinese (Simplified)
- `pt_BR` — Portuguese (Brazil)
- `ar` — Arabic

## Testing Localization

### Test Language Loading

```bash
# English (default)
http://localhost:8000/amortization-calc/amortization-calc_en.html

# Spanish (if translation exists)
http://localhost:8000/amortization-calc/amortization-calc_en.html?locale=es

# Force locale
http://localhost:8000/amortization-calc/amortization-calc_en.html?locale=fr
```

### Verify String Usage

**Check for hardcoded strings:**
```bash
# Search for suspicious English text in view code
grep -r "\"[A-Z]" js/amortization-calc/view/
```

**Verify all strings use properties:**
```typescript
// ✅ CORRECT - Uses LocalizedStringProperty
new Text( AmortizationCalcStrings.loanAmountStringProperty )

// ❌ WRONG - Hardcoded English
new Text( 'Loan Amount ($):' )
```

### Test Dynamic Updates

Strings automatically update when language changes at runtime:

```typescript
// Locale changes handled automatically by LocalizedStringProperty
// No additional code needed in view
```

## Pattern Variable Guidelines

### Naming Conventions
- Use descriptive variable names: `{{amount}}`, `{{months}}`, `{{number}}`
- Avoid abbreviations: `{{amt}}` → `{{amount}}`
- Use camelCase: `{{monthCount}}`, not `{{month_count}}`

### Common Patterns

**Currency amounts:**
```json
{
  "value": "Total: {{amount}}",
  "comment": "amount is formatted currency like $1,234.56"
}
```

**Numeric counts:**
```json
{
  "value": "Standard: {{months}} months",
  "comment": "months is an integer"
}
```

**Ordinal numbers:**
```json
{
  "value": "Year {{number}}",
  "comment": "number is ordinal year (1, 2, 3...)"
}
```

### Formatting in Code

Always format values before passing to `StringUtils.fillIn()`:

```typescript
StringUtils.fillIn( pattern, {
  amount: `$${value.toFixed( 2 )}`,           // Format currency
  months: value.toString(),                   // Convert to string
  percent: `${( value * 100 ).toFixed( 1 )}%` // Format percentage
} );
```

## Best Practices

### String Management
1. ✅ **Add all UI text to strings file** — no hardcoded English in code
2. ✅ **Use meaningful keys** — `loanAmount` not `string1`
3. ✅ **Group related strings** — use nested structure
4. ✅ **Add translator comments** — explain context when ambiguous
5. ✅ **Keep patterns simple** — minimize variables when possible

### Code Usage
1. ✅ **Import once at top** — `import AmortizationCalcStrings from '...'`
2. ✅ **Use DerivedProperty** — for strings with variables
3. ✅ **Preserve type safety** — let TypeScript catch missing strings
4. ✅ **Test without fallback** — ensure all strings exist in JSON
5. ✅ **Handle plurals properly** — use separate strings when needed

### Translation Considerations
1. ✅ **Leave room for expansion** — translated text may be 30-50% longer
2. ✅ **Don't concatenate strings** — use complete patterns
3. ✅ **Avoid assumptions** — word order varies by language
4. ✅ **Test RTL layouts** — Arabic, Hebrew read right-to-left
5. ✅ **Respect cultural norms** — currency symbols, date formats vary

## Common Issues

### Missing String Property

**Error:**
```
Property 'loanAmountStringProperty' does not exist on type 'StringsType'
```

**Solution:** Add string to JSON and run `grunt update`

### Pattern Variable Mismatch

**Error:**
```
// String pattern: "Monthly Payment: {{amount}}"
StringUtils.fillIn( pattern, { value: 123 } );  // Wrong variable name!
```

**Solution:** Match variable names exactly: `{ amount: 123 }`

### Hardcoded Strings in PDOM

**Problem:** Accessibility labels still in English for other locales

**Solution:** Use `LocalizedStringProperty` for all PDOM content:
```typescript
{
  labelContent: AmortizationCalcStrings.loanAmountStringProperty,
  descriptionContent: AmortizationCalcStrings.loanAmountDescriptionStringProperty
}
```

## References

- [PhET Localization Documentation](https://github.com/phetsims/babel/blob/main/doc/localization-overview.md)
- [StringUtils API](https://github.com/phetsims/phetcommon/blob/main/js/util/StringUtils.ts)
- [LocalizedStringProperty](https://github.com/phetsims/chipper/blob/main/js/browser/LocalizedStringProperty.ts)

## Future Enhancements

- [ ] Add RTL layout support for Arabic/Hebrew
- [ ] Currency symbol localization (not just $)
- [ ] Number format localization (commas vs periods)
- [ ] Date format localization (if date displays added)
- [ ] Pluralization support (e.g., "1 month" vs "2 months")
